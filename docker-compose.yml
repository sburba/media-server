# TODO: Stop using network_mode: host and make all the services talk to each other the right way
# I'm leaving all the port specifications in so that I don't have to look them up when I finally fix that

version: "3"
services: 
  couchpotato: 
    env_file: media.env
    image: linuxserver/couchpotato
    network_mode: host
    ports: ["5050:5050"]
    volumes: 
      - "${DOWNLOAD_DIR}:/downloads"
      - "${CONFIG_DIR}/couchpotato:/config"
      - "${MEDIA_DIR}/Movies:/movies"
  jackett: 
    env_file: media.env
    image: linuxserver/jackett
    network_mode: host
    ports: ["9117:9117"]
    volumes: 
      - "${DOWNLOAD_DIR}:/downloads"
      - "${CONFIG_DIR}/jackett:/config"
  nzbget: 
    env_file: media.env
    image: linuxserver/nzbget
    network_mode: host
    ports: ["6789:6789"]
    volumes: 
      - "${DOWNLOAD_DIR}:/downloads"
      - "${CONFIG_DIR}/nzbget:/config"
  plex: 
    env_file: plex.env
    environment: 
      - PLEX_CLAIM="${PLEX_CLAIM}"
    image: plexinc/pms-docker:plexpass
    network_mode: host
    volumes: 
      - "${CONFIG_DIR}/plex:/config"
      - "${MEDIA_DIR}:/data"
      - "${PLEX_TRANSCODE_DIR}:/transcode"
  ombi: 
    env_file: media.env
    image: linuxserver/ombi
    network_mode: host
    ports: ["3579:3579"]
    volumes: 
      - "${CONFIG_DIR}/ombi:/config"
      - "${MEDIA_DIR}/TV:/tv"
      - "/etc/localtime:/etc/locatime:ro"
  sonarr: 
    env_file: media.env
    image: linuxserver/sonarr
    network_mode: host
    ports: ["8989:8989"]
    volumes: 
      - "${DOWNLOAD_DIR}:/downloads"
      - "${CONFIG_DIR}/sonarr:/config"
      - "${MEDIA_DIR}/TV:/tv"
      - "/dev/rtc:/dev/rtc:ro"
  transmission: 
    env_file: media.env
    image: linuxserver/transmission
    network_mode: host
    ports: 
      - "9091:9091"
      - "51413:51413"
      - "51413:51413/udp"
    volumes: 
      - "${DOWNLOAD_DIR}:/downloads"
      - "${CONFIG_DIR}/transmission:/config"
  tarsnapper:
    image: dangmai/tarsnapper
    volumes:
      - "${CONFIG_DIR}:/backup:ro"
      - "./tarsnapper.conf:/etc/tarsnapper.conf:ro"
      - "/root/tarsnap.key:/tarsnap/key:ro"
      - "/etc/localtime:/etc/localtime:ro"
  caddy:
    image: abiosoft/caddy
    network_mode: host
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - "./Caddyfile:/etc/Caddyfile"
      - "./basicauth.conf:/etc/basicauth.conf"
      - "${CONFIG_DIR}/caddy:/root/.caddy"
